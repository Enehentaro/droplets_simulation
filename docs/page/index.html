<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="Simulation of Virus-Laden Droplets Behavior in AFDET">
    <meta name="author" content="Y.Ida" >
    <link rel="icon" href="../favicon.png">

    <title>Read Me &ndash; Droplets Simulation</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Droplets Simulation </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href='../page/index.html'>Read Me</a></li>
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
            <li><a href="../lists/programs.html">Programs</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/programs.html">Programs</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>Read Me</h1>
    <div class="row">
    <div class="col-lg-12">
    <div class="well well-sm" style="min-height: 40px;">
      <ul class="list-inline" style="margin-bottom:0px; display:inline">
<!--
-->
      </ul>
        <ol class="breadcrumb in-well">
         <li class="active">Read Me</li>
      </ol>
    </div>
    </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-md-9 col-md-push-3" id='text'>
      <h1>Droplets Simulation</h1>
<p>Simulation of Virus-Laden Droplets Behavior in AFDET</p>
<h2>ドキュメント</h2>
<p>https://enehentaro.github.io/droplet-FORD-docs/</p>
<p>※<a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>を使用しています</p>
<h2>使い方</h2>
<h3>依存関係解決・コンパイル</h3>
<p>ビルドに<code>cmake</code>コマンドを使います（<a href="https://qiita.com/ijknabla/items/05270ae5e597705d0dae#cmake-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">CMakeのインストール</a>が必要）。</p>
<ol>
<li><code>$ mkdir build</code>でビルドディレクトリ作成</li>
<li><code>$ cd build</code>で移動</li>
<li><code>$ cmake ..</code>で依存関係解決<ul>
<li>一部の環境(Windows等)では、<code>-G "MinGW Makefiles"</code>でGenerator指定</li>
<li><code>-D CMAKE_Fortran_COMPILER=[ifort/gfortran]</code>でコンパイラ指定</li>
<li><code>-D CMAKE_BUILD_TYPE=debug</code>でデバッグ用コンパイルオプション付与</li>
</ul>
</li>
<li><code>$ make</code>でコンパイル</li>
</ol>
<h3>実行</h3>
<p>ルートディレクトリ（README.mdのあるディレクトリ）での作業</p>
<ol>
<li>「SampleCase」ディレクトリを複製したのち、名前を変更する（ケース名を付ける）</li>
<li>ケースディレクトリ内の条件ファイル(condition.nml, initial_position.csv)を編集 </li>
<li><code>./build/bin/main</code>で実行。ケース名を入力して計算開始。</li>
</ol>
<h2>条件ファイル(condition.nml, initial_position.csv)解説</h2>
<h3>condition.nml</h3>
<ul>
<li><strong>リスタート位置 num_restart</strong><ul>
<li>通常は<code>0</code>を指定</li>
<li><code>1以上</code>にすると、その値に対応するbackupファイルが読み込まれ、そこからリスタートが始まる</li>
</ul>
</li>
<li><strong>初期分布ファイル名 initialDistributionFName</strong><ul>
<li>指定したbackupファイル(.bu)が読み込まれ、それを飛沫初期分布とする</li>
<li>初期分布を固定したくない場合はコメントアウトすること</li>
</ul>
</li>
<li><strong>飛沫周期発生 periodicGeneration</strong><ul>
<li>1秒当たりの発生飛沫数（整数）を指定</li>
<li>初期配置飛沫をすべてNonActiveにしたのち、順次Activateしていくので、初期配置数が飛沫数の上限となる</li>
</ul>
</li>
<li><strong>気流データファイル名 path2FlowFile</strong><ul>
<li>実行ディレクトリからの相対パス、もしくは絶対パスを指定</li>
<li>現在可能な流れ場ファイル：</li>
<li>VTK</li>
<li>INP</li>
<li>FLD</li>
<li>CUBE格子(PLOT3D)は、予め非構造格子に変換してから計算してください。</li>
<li>.arrayファイルを指定する場合、別途メッシュファイルが必要なので、<code>meshFile = ***</code>と指定する</li>
</ul>
</li>
<li><strong>ステップ数オフセット OFFSET</strong><ul>
<li>飛沫計算を、流体連番ファイルの途中の番号から始めたいときに指定</li>
</ul>
</li>
<li><strong>気流データを周期的に用いる場合の先頭と末尾 LoopHead, LoopTail</strong><ul>
<li>任意の区間の流体連番ファイルを繰り返し用いるときに指定（例えば呼吸のサイクル）</li>
<li><code>(先頭) = (末尾)</code> とすると、そのステップ数到達後は流れ場の更新が起こらなくなる</li>
<li><code>(先頭) &gt; (末尾)</code> とすれば、特殊な処理は起こらず、流体連番ファイルが順番に読み込まれる</li>
</ul>
</li>
</ul>
<h3>initial_position.csv</h3>
<ul>
<li>初期飛沫の配置帯（直方体）を設定する</li>
<li>左から順に、直方体の中心座標(x,y,z), 直方体の幅(x,y,z)</li>
<li>改行すれば配置帯を複数設定できる</li>
</ul>
<h2>方程式</h2>
<h3>飛沫の蒸発方程式</h3>
<p>
<script type="math/tex; mode=display"> \frac{dr}{dt} \space = \space -\left(1-\frac{RH}{100}\right) \cdot \frac{D e_{s}(T)}{\rho_{w} R_{v} T} \cdot \frac{1}{r} </script>
</p>
<p>プログラム内では、２次精度ルンゲクッタ法で解いている。</p>
<h3>飛沫の運動方程式</h3>
<p>
<script type="math/tex; mode=display"> m \frac{d \mathbf{v}}{dt} \space = \space m \mathbf{g} \space + \space C_D (\mathbf{v}) \space \cdot \space \frac{1}{2} \rho_a S \left | \mathbf{u}_a - \mathbf{v} \right | (\mathbf{u}_a - \mathbf{v}) </script>
</p>
<p>プログラム内では、上式を無次元化・離散化した次式を解いている。</p>
<p>
<script type="math/tex; mode=display"> \bar{\mathbf{v}}^{n + 1} \space = \space \frac{\bar{\mathbf{v}}^{n} \space + \space (\bar{\mathbf{g}} \space + \space C \bar{\mathbf{u}}_a)\Delta \bar{t}}{1 \space + \space C\Delta \bar{t}} \quad \left ( C \space = \space \frac{3 \rho_a}{8 \rho_w} \frac{C_D ( \mathbf{v}^{n} ) \left | \bar{\mathbf{u}}_a - \bar{\mathbf{v}}^{n} \right |}{\bar{r}^{n+1}} \right ) </script>
</p>
<h2>サブプログラム</h2>
<ul>
<li>CUBE2USG<ul>
<li>CUBE格子を、非構造格子に変換できる</li>
</ul>
</li>
<li>droplet2CSV<ul>
<li>飛沫計算結果を再度読み込み、統計データ（浮遊数推移など）をCSVファイルに書き出す</li>
</ul>
</li>
<li>dropletCount<ul>
<li>飛沫計算結果を再度読み込み、カウントボックスを通過した飛沫数を調べる。optionディレクトリ内の"boxList.csv"を、ケースディレクトリに配置する必要がある。</li>
</ul>
</li>
<li>initialTranslate<ul>
<li>飛沫の初期配置データを読み込み、任意の座標への回転、平行移動を行う。<strong>by Konishi</strong></li>
</ul>
</li>
</ul>
<h2>おまけ機能</h2>
<ul>
<li><strong>複数ケース連続実行</strong><ul>
<li>実行時にTXTファイル名を入力すると、そのファイルに列挙された複数ケースを連続実行できる</li>
</ul>
</li>
<li><strong>basicSetting.nml</strong><ul>
<li>optionディレクトリ内にある。付着判定のオンオフや、飛沫間合体の設定が可能。初期半径分布ファイルの指定も可能。</li>
</ul>
</li>
</ul>
<h2>CTest</h2>
<ul>
<li>コンパイル後、<code>$ ctest</code>でCTestが実行可能（buildディレクトリにて）</li>
<li>CTestの実行ディレクトリは、<code>test/</code>になる（buildディレクトリではない）</li>
<li>テスト用プログラムはすべて<code>test/</code>で管理しよう</li>
</ul>
    </div>
  </div>
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>Droplets Simulation was developed by Y.Ida<br>&copy; 2022 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
</p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>